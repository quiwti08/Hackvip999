--// Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalizationService = game:GetService("LocalizationService")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Lighting = game:GetService("Lighting")
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local StarterGui = game:GetService("StarterGui")
local Camera = Workspace.CurrentCamera
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local TextChatService = game:GetService("TextChatService")

local chatWindow = TextChatService:FindFirstChild("ChatWindowConfiguration")
if chatWindow then
    chatWindow.Enabled = true -- Bật lại chat window
end

--// GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "DhuyxMenu"
gui.ResetOnSpawn = false
gui.Parent = game:GetService("CoreGui")
gui.DisplayOrder = 10000
gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
gui.IgnoreGuiInset = true

--// Config
local Config = { 
    CustomPing = 40,
    Buttons = {}, 
    ESPEnabled = false,
    SpeedEnabled = false,
    FlyEnabled = false,
    AimbotEnabled = false,
    FullbrightEnabled = false,
    NoclipEnabled = false,
    ShiftAmount = 0.5,
    SelectedPlayers = {},
    FlySpeed = 35,
    SpeedAmount = 20,
    clickTpEnabled = false,
    MacroLegitEnabled = false,
    AntiLockEnabled = false,
    AntiLockType = "Behind",
    LookAtEnabled = false,
    CsyncRandomEnabled = false,
    CsyncOrbitEnabled = false,
    CsyncRadius = 10,
    CsyncHeight = 5,
    CsyncSpeed = 5,
    AutoWallhopEnabled = false,
    SpinbotEnabled = false,
    SpinbotSpeed = 450,
    Prediction = nil,
    FakeSpeedEnabled = false,
    FakeSpeedAmount = 300,
    OnlyTargetHitbox = false,
    RainbowHitEffectEnabled = true,
}

getgenv().HitboxSize = 15
getgenv().HitboxTransparency = 0.9
getgenv().HitboxStatus = "OFF"  -- "OFF", "NoVisual", "Visual"
getgenv().TeamCheck = false

local Keybinds = {}

--// Helpers
local function attachButtonEffects(btn, shrinkPx)
    local orig = btn.Size
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(200, 200, 200)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(180, 180, 180)}):Play()
    end)
    btn.MouseButton1Click:Connect(function()
        local s = shrinkPx or 3
        local toSmall = UDim2.new(orig.X.Scale, math.max(0, orig.X.Offset - s), orig.Y.Scale, math.max(0, orig.Y.Offset - s))
        local t1 = TweenService:Create(btn, TweenInfo.new(0.08), {Size = toSmall})
        local t2 = TweenService:Create(btn, TweenInfo.new(0.08), {Size = orig})
        t1:Play(); t1.Completed:Wait(); t2:Play()
    end)
end

local function makeSmoothDraggable(frame, speed)
    speed = speed or 0.2
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        local goal = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        TweenService:Create(frame, TweenInfo.new(speed, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {Position = goal}):Play()
    end
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then update(input) end
    end)
end

local function CreateButton(parent, name, callback)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, -10, 0, 30)
    buttonFrame.BackgroundTransparency = 1
    buttonFrame.Parent = parent

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.7, -5, 1, 0)
    button.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    button.BackgroundTransparency = 0.2
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.Text = name
    button.Parent = buttonFrame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    attachButtonEffects(button, 3)
    button.MouseButton1Click:Connect(callback)

    local keyBox = Instance.new("TextBox")
    keyBox.Size = UDim2.new(0.3, 0, 1, 0)
    keyBox.Position = UDim2.new(0.7, 5, 0, 0)
    keyBox.BackgroundColor3 = Color3.fromRGB(230, 230, 230)
    keyBox.PlaceholderText = "Key"
    keyBox.Text = ""
    keyBox.TextColor3 = Color3.fromRGB(0, 0, 0)
    keyBox.TextSize = 14
    keyBox.Font = Enum.Font.Gotham
    keyBox.ClearTextOnFocus = false
    keyBox.Parent = buttonFrame
    Instance.new("UICorner", keyBox).CornerRadius = UDim.new(0, 6)

    keyBox:GetPropertyChangedSignal("Text"):Connect(function()
        local text = keyBox.Text:upper()
        if text == "" then
            for k, v in pairs(Keybinds) do
                if v == callback then
                    Keybinds[k] = nil
                end
            end
        elseif text == "BUTTON" then
            local screenGui = Instance.new("ScreenGui")
            screenGui.IgnoreGuiInset = true
            screenGui.Parent = game:GetService("CoreGui")

            local screenBtn = Instance.new("TextButton")
            screenBtn.Size = UDim2.new(0, 70, 0, 30)
            screenBtn.Position = UDim2.new(0, 100, 0, 300)
            screenBtn.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
            screenBtn.Text = name
            screenBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
            screenBtn.TextSize = 10
            screenBtn.Font = Enum.Font.GothamBold
            screenBtn.Parent = screenGui
            Instance.new("UICorner", screenBtn).CornerRadius = UDim.new(0, 6)
            makeSmoothDraggable(screenBtn, 0.18)
            attachButtonEffects(screenBtn, 3)
            screenBtn.MouseButton1Click:Connect(callback)
        else
            if Enum.KeyCode[text] then
                Keybinds[text] = nil
                Keybinds[text] = callback
            end
        end
    end)

    return button
end

-- Hàm kiểm tra xem có phải thiết bị cảm ứng không
local function isTouchDevice()
    return UserInputService.TouchEnabled and not (UserInputService.MouseEnabled or UserInputService.KeyboardEnabled)
end

-- Tạo Toggle Button
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Size = UDim2.new(0, 45, 0, 45)
ToggleButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
ToggleButton.Image = "rbxassetid://80952463173309"
ToggleButton.ScaleType = Enum.ScaleType.Fit
ToggleButton.Parent = gui
Instance.new("UICorner", ToggleButton).CornerRadius = UDim.new(0, 10)
makeSmoothDraggable(ToggleButton, 0.18)

-- Đặt vị trí dựa trên thiết bị
if isTouchDevice() then
    ToggleButton.Position = UDim2.new(0, 15, 0, 250) -- Giữ nguyên cho điện thoại
else
    ToggleButton.Position = UDim2.new(0, 770, 0, 715) -- Vị trí cho PC
end

--// MainFrame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Position = UDim2.new(0.08, 0, 0.2, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.Visible = true
MainFrame.Parent = gui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)
makeSmoothDraggable(MainFrame, 0.2)

-- Shadow
local shadow = Instance.new("ImageLabel", MainFrame)
shadow.Size = UDim2.new(1, 30, 1, 30)
shadow.Position = UDim2.new(0, -15, 0, -15)
shadow.Image = "rbxassetid://1316045217"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.4
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.ZIndex = -1
shadow.BackgroundTransparency = 1

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, -10, 0, 35)
Title.Position = UDim2.new(0, 5, 0, 5)
Title.Text = "Xinloinguoiyeu"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1

-- Ping/FPS/Clock
local PingClock = Instance.new("TextLabel")
PingClock.Size = UDim2.new(0, 200, 0, 25)
PingClock.Position = UDim2.new(0, 5, 0, 35)
PingClock.BackgroundTransparency = 1
PingClock.TextColor3 = Color3.fromRGB(200, 200, 200)
PingClock.Font = Enum.Font.Gotham
PingClock.TextSize = 12
PingClock.Parent = MainFrame

task.spawn(function()
    local lastDt = 1/60
    RunService.RenderStepped:Connect(function(dt) lastDt = dt end)
    while task.wait(0.5) do
        local ping =  math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue())
        local fps = math.clamp(math.floor(1 / (lastDt > 0 and lastDt or 1/240)), 1, 999)
        local timeStr = os.date("%H:%M")
        PingClock.Text = string.format("Ping: %d ms | FPS: %d | %s", ping, fps, timeStr)
    end
end)

--// Tabs
local TabHolder = Instance.new("Frame", MainFrame)
TabHolder.Size = UDim2.new(1, -10, 0, 30)
TabHolder.Position = UDim2.new(0, 5, 0, 65)
TabHolder.BackgroundTransparency = 1
local TabLayout = Instance.new("UIListLayout", TabHolder)
TabLayout.FillDirection = Enum.FillDirection.Horizontal
TabLayout.Padding = UDim.new(0, 5)

local function createTab(name)
    local btn = Instance.new("TextButton", TabHolder)
    btn.Size = UDim2.new(0, 90, 1, 0) -- Adjusted for 4 tabs
    btn.Text = name
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    attachButtonEffects(btn, 3)
    return btn
end

local Tab1Btn = createTab("Da Hood")
local Tab2Btn = createTab("Universal")
local Tab3Btn = createTab("Scripts")
local Tab5Btn = createTab("Info")

--// Pages
local Pages = Instance.new("Frame", MainFrame)
Pages.Size = UDim2.new(1, -10, 1, -105)
Pages.Position = UDim2.new(0, 5, 0, 100)
Pages.BackgroundTransparency = 1
Pages.ClipsDescendants = true

local Page1 = Instance.new("Frame", Pages) -- Da Hood
Page1.Size = UDim2.new(1, 0, 1, 0)
Page1.BackgroundTransparency = 1

local Page2 = Instance.new("Frame", Pages) -- Universal
Page2.Size = UDim2.new(1, 0, 1, 0)
Page2.BackgroundTransparency = 1
Page2.Visible = false

local Page3 = Instance.new("Frame", Pages) -- Scripts
Page3.Size = UDim2.new(1, 0, 1, 0)
Page3.BackgroundTransparency = 1
Page3.Visible = false

local Page5 = Instance.new("Frame", Pages) -- Info
Page5.Size = UDim2.new(1, 0, 1, 0)
Page5.BackgroundTransparency = 1
Page5.Visible = false

local function switchPage(page)
    Page1.Visible = (page == Page1)
    Page2.Visible = (page == Page2)
    Page3.Visible = (page == Page3)
    Page5.Visible = (page == Page5)
end

Tab1Btn.MouseButton1Click:Connect(function() switchPage(Page1) end)
Tab2Btn.MouseButton1Click:Connect(function() switchPage(Page2) end)
Tab3Btn.MouseButton1Click:Connect(function() switchPage(Page3) end)
Tab5Btn.MouseButton1Click:Connect(function() switchPage(Page5) end)

--// Page 1 (Da Hood)
local ButtonFrame1 = Instance.new("ScrollingFrame", Page1)
ButtonFrame1.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame1.Position = UDim2.new(0, 5, 0, 10)
ButtonFrame1.BackgroundTransparency = 1
ButtonFrame1.ScrollBarThickness = 4
ButtonFrame1.CanvasSize = UDim2.new(0, 0, 0, 0)

local ButtonLayout1 = Instance.new("UIListLayout", ButtonFrame1)
ButtonLayout1.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout1.Padding = UDim.new(0, 6)
ButtonLayout1:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame1.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout1.AbsoluteContentSize.Y)
end)

local PlayerListFrame = Instance.new("ScrollingFrame", Page1)
PlayerListFrame.Size = UDim2.new(0.5, -5, 1, -20)
PlayerListFrame.Position = UDim2.new(0.5, 0, 0, 10)
PlayerListFrame.BackgroundTransparency = 1
PlayerListFrame.ScrollBarThickness = 4
PlayerListFrame.CanvasSize = UDim2.new(0, 0, 0, 0)

local UIListLayout = Instance.new("UIListLayout", PlayerListFrame)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 4)
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    PlayerListFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end)

local function UpdatePlayerList()
    for _, child in pairs(PlayerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -4, 0, 20)
            button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            button.BackgroundTransparency = 0.2
            button.TextColor3 = Color3.fromRGB(0, 0, 0)
            button.TextSize = 14
            button.Font = Enum.Font.Gotham
            button.AutoButtonColor = false
            button.Parent = PlayerListFrame

            local function UpdateButtonText()
                local isSelected = Config.SelectedPlayers[player.Name]
                button.Text = (isSelected and "✓ " or "") .. player.DisplayName  -- Chỉ giữ DisplayName, xóa tên gốc để gọn
            end

            button.MouseButton1Click:Connect(function()
                Config.SelectedPlayers[player.Name] = not Config.SelectedPlayers[player.Name]
                UpdateButtonText()
            end)

            attachButtonEffects(button, 3)
            UpdateButtonText()
        end
    end
end

-- Gọi ban đầu và khi player add/remove
UpdatePlayerList()
Players.PlayerAdded:Connect(UpdatePlayerList)
Players.PlayerRemoving:Connect(UpdatePlayerList)

--// Page 2 (Universal)
local ButtonFrame2Left = Instance.new("ScrollingFrame", Page2)
ButtonFrame2Left.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame2Left.Position = UDim2.new(0, 5, 0, 10)
ButtonFrame2Left.BackgroundTransparency = 1
ButtonFrame2Left.ScrollBarThickness = 4
ButtonFrame2Left.CanvasSize = UDim2.new(0, 0, 0, 0)

local ButtonLayout2Left = Instance.new("UIListLayout", ButtonFrame2Left)
ButtonLayout2Left.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout2Left.Padding = UDim.new(0, 6)
ButtonLayout2Left:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame2Left.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout2Left.AbsoluteContentSize.Y)
end)

local ButtonFrame2Right = Instance.new("ScrollingFrame", Page2)
ButtonFrame2Right.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame2Right.Position = UDim2.new(0.5, 0, 0, 10)
ButtonFrame2Right.BackgroundTransparency = 1
ButtonFrame2Right.ScrollBarThickness = 4
ButtonFrame2Right.CanvasSize = UDim2.new(0, 0, 0, 0)

local ButtonLayout2Right = Instance.new("UIListLayout", ButtonFrame2Right)
ButtonLayout2Right.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout2Right.Padding = UDim.new(0, 6)
ButtonLayout2Right:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame2Right.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout2Right.AbsoluteContentSize.Y)
end)

--// Page 3 (Scripts)
local ScriptHubScroll = Instance.new("ScrollingFrame", Page3)
ScriptHubScroll.Size = UDim2.new(1, -10, 1, -30) -- Extended height for more space
ScriptHubScroll.Position = UDim2.new(0, 5, 0, 5)
ScriptHubScroll.BackgroundTransparency = 1
ScriptHubScroll.ScrollBarThickness = 6
ScriptHubScroll.ScrollingDirection = Enum.ScrollingDirection.Y
ScriptHubScroll.CanvasSize = UDim2.new(0, 0, 0, 0)

local ScriptListLayout = Instance.new("UIListLayout", ScriptHubScroll)
ScriptListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ScriptListLayout.Padding = UDim.new(0, 6)
ScriptListLayout.FillDirection = Enum.FillDirection.Vertical
ScriptListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ScriptHubScroll.CanvasSize = UDim2.new(0, 0, 0, ScriptListLayout.AbsoluteContentSize.Y)
end)

local function CreateScriptItem(name, url)
    local itemFrame = Instance.new("Frame", ScriptHubScroll)
    itemFrame.Size = UDim2.new(1, 0, 0, 35)
    itemFrame.BackgroundTransparency = 0.2
    itemFrame.BackgroundColor3 = Color3.fromRGB(230, 230, 230)

    local nameLabel = Instance.new("TextLabel", itemFrame)
    nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
    nameLabel.Position = UDim2.new(0, 5, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextSize = 16
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left

    local runBtn = Instance.new("TextButton", itemFrame)
    runBtn.Size = UDim2.new(0.3, -10, 1, -4)
    runBtn.Position = UDim2.new(0.7, 5, 0, 2)
    runBtn.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    runBtn.Text = "Run"
    runBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    runBtn.TextSize = 16
    runBtn.Font = Enum.Font.GothamBold
    Instance.new("UICorner", runBtn).CornerRadius = UDim.new(0, 6)
    attachButtonEffects(runBtn, 3)
    runBtn.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet(url))()
    end)

    Instance.new("UICorner", itemFrame).CornerRadius = UDim.new(0, 6)
    return itemFrame
end

CreateScriptItem("Evade", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade")
CreateScriptItem("Murder Mystery 2", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2")
CreateScriptItem("Blade Ball", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball")
CreateScriptItem("Doors", "https://raw.githubusercontent.com/DarkDoorsKing/Project/main/Doors.lua")
CreateScriptItem("free all animation", "https://yarhm.mhi.im/scr?channel=afemmax")
CreateScriptItem("Infinite Yield", "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source")
CreateScriptItem("Dex", "https://raw.githubusercontent.com/infyiff/backup/main/dex.lua")
CreateScriptItem("Hypershot", "https://api.luarmor.net/files/v3/loaders/c9f7b2cda8460f26a85bc14a419b3513.lua")
CreateScriptItem("simpleaim", "https://raw.githubusercontent.com/quiwti08/Hackvip999/refs/heads/main/simpleaimlockvip")
CreateScriptItem("The mimic", "https://raw.githubusercontent.com/Laelmano24/Rael-Hub/main/main.txt")


--// Page 5 (Info)
local Avatar = Instance.new("ImageLabel", Page5)
Avatar.Size = UDim2.new(0, 80, 0, 80)
Avatar.Position = UDim2.new(0, 10, 0, 10)
Avatar.BackgroundTransparency = 1
Avatar.Image = "rbxthumb://type=AvatarHeadShot&id="..LocalPlayer.UserId.."&w=150&h=150"

local InfoPanel = Instance.new("Frame", Page5)
InfoPanel.Position = UDim2.new(0, 100, 0, 10)
InfoPanel.Size = UDim2.new(1, -110, 1, -20)
InfoPanel.BackgroundTransparency = 1
InfoPanel.ClipsDescendants = true

local InfoLayout = Instance.new("UIListLayout", InfoPanel)
InfoLayout.Padding = UDim.new(0, 6)
InfoLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
InfoLayout.VerticalAlignment = Enum.VerticalAlignment.Top

local function mkLine()
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(1, -10, 0, 22)
    l.BackgroundTransparency = 1
    l.Font = Enum.Font.Gotham
    l.TextSize = 14
    l.TextColor3 = Color3.fromRGB(200, 200, 200)
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.TextWrapped = false
    l.ClipsDescendants = true
    l.Parent = InfoPanel
    return l
end

local lineDisplay 